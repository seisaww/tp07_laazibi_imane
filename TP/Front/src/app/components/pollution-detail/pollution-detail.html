<div class="page-container d-flex justify-content-center min-vh-100 py-5">

  @if (isLoading) {
    <div class="d-flex flex-column align-items-center justify-content-center w-100 mt-5">
      <div class="spinner-border text-success" style="width: 3rem; height: 3rem;" role="status">
        <span class="visually-hidden">Chargement...</span>
      </div>
      <p class="text-muted mt-3 fw-bold animate-pulse">Récupération des données...</p>
    </div>
  } 
  @else {

    @if (pollution) {
      
      @if (!pollutionToEdit) {
        
        <div class="w-100 d-flex flex-column align-items-center">

          @if (successMessage) {
            <div class="alert alert-success border-success-subtle shadow-sm rounded-4 mb-4 d-flex align-items-center animate-fade-in w-100" style="max-width: 800px;" role="alert">
              <i class="bi bi-check-circle-fill fs-4 me-3 text-success"></i>
              <div>
                <strong class="d-block">Modifications enregistrées !</strong>
                {{ successMessage }}
              </div>
              <button type="button" class="btn-close ms-auto" (click)="successMessage = null" aria-label="Close"></button>
            </div>
          }

          <div class="card shadow-lg border-0 rounded-4 animate-fade-in" style="max-width: 800px; width: 100%;">
            
            <div class="card-header bg-white border-0 pt-4 pb-0 text-center">
              <div class="mb-2">
                <span class="badge bg-success-subtle text-success border border-success-subtle rounded-pill px-3 py-2 text-uppercase ls-1">
                  {{ pollution.type_pollution }}
                </span>
              </div>
              <h2 class="text-dark fw-bold mb-0">{{ pollution.titre }}</h2>
            </div>
            
            <div class="card-body p-4 p-md-5">
              
              <div class="row g-3 mb-4">
                <div class="col-md-6">
                  <div class="p-3 rounded-3 bg-light h-100 border border-light-subtle d-flex align-items-center">
                    <i class="bi bi-calendar-event text-success fs-4 me-3"></i>
                    <div>
                      <div class="text-muted small text-uppercase fw-bold">Date</div>
                      <div class="fw-semibold text-dark">{{ pollution.date_observation | date:'fullDate' }}</div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="p-3 rounded-3 bg-light h-100 border border-light-subtle d-flex align-items-center">
                    <i class="bi bi-geo-alt text-success fs-4 me-3"></i>
                    <div>
                      <div class="text-muted small text-uppercase fw-bold">Lieu</div>
                      <div class="fw-semibold text-dark">{{ pollution.lieu }}</div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="mb-4">
                <h5 class="text-secondary fw-bold mb-3 border-bottom pb-2">Description</h5>
                <p class="text-dark fs-5" style="line-height: 1.8;">{{ pollution.description }}</p>
              </div>
              
              @if (pollution.photo_url) {
                <div class="mb-4">
                  <div class="photo-container rounded-4 overflow-hidden shadow-sm border border-light-subtle position-relative">
                    <span class="position-absolute top-0 start-0 bg-dark text-white opacity-75 px-3 py-1 rounded-bottom-end small">Preuve photo</span>
                    <img [src]="pollution.photo_url" [alt]="pollution.titre" class="img-fluid w-100 object-fit-cover">
                  </div>
                </div>
              }

              <div class="text-center">
                <span class="badge bg-light text-secondary border rounded-pill fw-normal px-3 py-2">
                  <i class="bi bi-crosshair me-1"></i> GPS: {{ pollution.latitude }}, {{ pollution.longitude }}
                </span>
              </div>
            </div>

            <div class="card-footer bg-white border-0 pb-4 pt-0">
              
              @if (!authService.estConnecte()) {
                <div class="text-center mb-3 animate-fade-in">
                  <span class="badge bg-warning-subtle text-warning-emphasis border border-warning-subtle rounded-pill px-3 py-2">
                    <i class="bi bi-lock-fill me-1"></i> Connectez-vous pour interagir
                  </span>
                </div>
              }

              <div class="d-flex justify-content-center gap-3 flex-wrap">
                
                <button class="btn btn-secondary rounded-pill px-4" routerLink="/pollutions/liste">
                  <i class="bi bi-arrow-left me-1"></i> Retour
                </button>

                <button 
                  class="btn rounded-pill px-4 fw-bold"
                  [class.btn-warning]="isFavori()"
                  [class.btn-outline-warning]="!isFavori()"
                  (click)="toggleFavori()"
                  [disabled]="!authService.estConnecte()"> 
                  <i class="bi" [class.bi-star-fill]="isFavori()" [class.bi-star]="!isFavori()"></i>
                  {{ isFavori() ? 'Favori' : 'Ajouter Favori' }}
                </button>
                
                <button 
                  class="btn btn-outline-success rounded-pill px-4 fw-bold" 
                  (click)="editPollution()"
                  [disabled]="!authService.estConnecte()"> 
                  <i class="bi bi-pencil-square me-1"></i> Modifier
                </button>
                
                <button 
                  class="btn btn-outline-danger rounded-pill px-4" 
                  (click)="deletePollution()"
                  [disabled]="!authService.estConnecte()"> 
                  <i class="bi bi-trash me-1"></i> Supprimer
                </button>

              </div>
            </div>

          </div>
        </div>
      }

      @if (pollutionToEdit) {
        <div class="w-100 animate-fade-in" style="max-width: 800px;">
          <app-pollution-from 
            [pollutionAEditer]="pollutionToEdit"
            (pollutionDeclaree)="handlePollutionUpdated($event)"
            (annulerModification)="cancelEdit()"
          ></app-pollution-from>
        </div>
      }

    } @else {
      
      <div class="d-flex flex-column align-items-center justify-content-center w-100 animate-fade-in mt-5">
        <i class="bi bi-exclamation-circle text-muted" style="font-size: 4rem;"></i>
        <h3 class="mt-3 text-muted">Signalement introuvable</h3>
        <button class="btn btn-success rounded-pill mt-3" routerLink="/pollutions/liste">Retour à la liste</button>
      </div>
    }

  }

</div>